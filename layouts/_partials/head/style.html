<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link 
    href="{{ .Site.Data.external.InterFont.Style }}" 
    rel="preload" 
    as="style" 
    onload="this.rel='stylesheet'"
>
<noscript>
    <link 
        rel="stylesheet" 
        href="{{ .Site.Data.external.InterFont.Style }}"
    >
</noscript>

{{ $core := resources.Get "scss/core.scss" }}
{{ $moduleLoader := resources.Get "scss/loader.scss" }}

{{ $options := (dict "transpiler" "dartsass")  }}
{{ if hugo.IsProduction }}
    {{ $options = merge $options (dict "outputStyle" "compressed" "enableSourceMap" false)  }}
{{ end }}

{{ $coreStyle := $core | css.Sass $options }}
<style>
    {{ $coreStyle.Content | safeCSS }}
</style>

{{ if .Scratch.Get "CSSModulesCritical" }}
    {{ $hash := md5 (delimit (.Scratch.Get "CSSModulesCritical") ",")}}
    {{ $style := $moduleLoader | resources.ExecuteAsTemplate (printf "css/critical.%s.scss" $hash) (dict "Context" . "Modules" (.Scratch.Get "CSSModulesCritical")) | css.Sass $options }}
        
    <style>
        {{ $style.Content | safeCSS }}
    </style>
{{ end }}


{{ range (default slice (.Scratch.Get "CSSModules")) }}
    {{ $hash := md5 . }}
    {{ $module := resources.Get (printf "scss/modules/%s.scss" .) }}
    {{ $opt := merge $options (dict "targetPath" (printf "css/%s.css" $hash)) }}
    {{ $style := $module | css.Sass $opt }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
{{ end }}